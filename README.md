# Softwares and codes used for my Bachelor Thesis.
For [my Bachelor Thesis](https://noesis.uis.edu.co/items/478aeafb-279a-4670-9ba6-fd6c6e34c6d5) I extensively used routines and Monte Carlo simulations for modeling processes such as the creation of EAS (Extensive Air Showers) and the interaction of muons with the ground. My initial goal was to make use of a full pipeline of simulations starting with the creation of atmospheric profiles via GDAS for their use on CORSIKA (a software for estimating EAS) and the integration of the MAGNETOCOSMICS software for correcting the flux of secondary cosmic rays according to the magnetic field (based on [this](https://agupubs.onlinelibrary.wiley.com/doi/pdf/10.1002/2017SW001774) work). Also, I ended up integrating a Geant4 environment edited in such a way to easily study the interaction of muons with the ground, which I refer to as MFS (Muon Forward Scattering) in my thesis.

This work has served as a good proof of concept for exploring the chained use of these software packages and independent computer codes, and seeing that, indeed, this simulation pipeline is useful and valid in a real scientific concept, like the study of MFS I carried out in my thesis. Taking into account the importance of science communication and the sharing of useful tools, I created this GitHub repository that contains the codes designed and edited by me and my thesis supervisors, that were used on this simulation pipeline.

This repository is divided in two: a first section dedicated to the simulation of EAS inside the folder *CORSIKA_MAGNETOCOSMICS*, and a second section with our Geant4 environment for the study of MFS inside the folder *Geant4/G4_Muon_Scattering*.

## **CORSIKA_MAGNETOCOSMICS**
For the modeling of EAS we designed two Python codes, written and documented on Jupyter Notebooks that would help the user on two important stages of the simulation chain: the creation of monthly atmospheric profiles via GDAS (based on [this work](https://arxiv.org/pdf/2006.01224.pdf)) and the correction of the spectrum of secondary cosmic rays taking into account geomagnetic effects (based on [this work](https://www.researchgate.net/publication/303024725_Modulacion_de_Rayos_Cosmicos_Secundarios_a_Nivel_del_Suelo_por_Cambios_en_el_Campo_Geomagnetico) and [this work](http://tangara.uis.edu.co/biblioweb/tesis/2020/178633.pdf)). Our approach was to start off from the codes already created for the cited works and designing our own Notebooks with the goal of simplifying their use.

### **GDAS_atmosphere_Persephone**
This subdirectory contains the **Persephone.ipynb** notebook which aids the user in creating a monthly atmospheric profile via GDAStool. In this very same subdirectory there is a folder called *scripts* that contains the files necessary for correctly running the notebook, including the *gdastool* Python script. This notebook is based on [this work](https://arxiv.org/pdf/2006.01224.pdf). The basic requirements for running the notebook are having Python 3.6 or more recent and having a build of CERN's Root installed (it can be downloaded for free [here](https://root.cern/install/build_from_source/)). The notebook must be run on a machine with Ubuntu OS.

This is how the notebook works: When running the full notebook, it will ask the user to enter relevant parameters such as the geographical coordinates of the simulation place, as well as a date (month and year) to obtain the data from GDAS. The notebook uses these parameters to run the *gdastool* script to create two atmospheric profiles for each day on the selected month. Once this is done, the notebook automatically runs two C++ scripts (*primera_parte.C* and *segunda_parte.C*) that will join all these daily profiles into one single average monthly profile. This average monthly profile can be directly used as an input in CORSIKA simulations.

![persephone](https://user-images.githubusercontent.com/31867192/212496698-e895ea36-ca2d-4b26-b887-eb8d7f69916d.png)
This is a screenshot of the Persephone.ipynb for creating average monthly atmospheric profiles via GDAStool.

### **MAGCO_Merovingian**
Our approach here was similar to the former code, this time based on [this work](https://www.researchgate.net/publication/303024725_Modulacion_de_Rayos_Cosmicos_Secundarios_a_Nivel_del_Suelo_por_Cambios_en_el_Campo_Geomagnetico) and [this work](http://tangara.uis.edu.co/biblioweb/tesis/2020/178633.pdf). The notebook called *The Merovingian.ipynb* uses the files located in the *scripts* folder to create a MACRO file that can be used as an input for MAGNETOCOSMICS, with the goal of calculating cutoff rigidity values for primary cosmic rays that enter the atmosphere. Once again, the basic requirements are Python 3.6 or later and a system with Ubuntu.

This notebook asks the user for the important parameters for running MAGNETOCOSMICS; amongst them are the geographical coordinates of the simulation place, as well as a specific date and time to extract the data from the *wghour.d* file, a database for the TSY01 external magnetic field model. The notebook automatically creates a file with the extension .g4mac that must be used as an input in MAGNETOCOSMICS to calculate the cutoff rigidity. More specific and detailed instructions can be found within the notebook. Due to the enormous expense in both time and computer power, it is recommended to only run MAGNETOCOSMICS on a remote server or cluster with that software available. This notebook, however, can be easily run on simple machines without too much expense. After running MAGNETOCOSMICS, a text file will be created with the full list of cutoff rigidity values calculated. To apply the correction of the CORSIKA cosmic rays output file one must have the CrkTools kit.

![merovingian](https://user-images.githubusercontent.com/31867192/212497171-37d4388f-b541-4fca-bfbc-e20f32d42b4d.png)
This is a screenshot of the The Merovingian.ipynb notebook, used to create a MACRO input file for MAGNETOCOSMICS.

## **Geant4/G4_Muong_Scattering**
This directory contains a Geant4 build for the study of MFS through Monte Carlo simulations of the interaction between muons and a solid volume of standard rock. This Geant4 environment is based on [the one used by the LAGO collaboration](http://wiki.lagoproject.net/index.php/Main_Page) and implemented on [this work](http://tangara.uis.edu.co/biblioweb/pags/cat/popup/pa_detalle_matbib.jsp?parametros=186435%7C%20%7C3%7C20) and [this work](https://iopscience.iop.org/article/10.1088/1748-0221/15/08/P08004/pdf) to simulate the MuTe detector. We implemented our own minor edits to facilitate the study of MFS. The changes we made were:
* Deleting the WCD (Water Cherenkov Detector) present in the code, since we were only interested in seeing the interaction between muons and the standard rock ground.
* Discarding particles other than muons from the output files to save space and computer power.
* Adding the option to change the name of the output histograms file directly on the input_vem.in file.

This directory includes the original README file with basic instructions on how to run the software. The requirements are having Root and a compatible Geant4 installation (we used the Geant4-10.06 version). While it would be possible to use this G4 environment on a personal computer, the best option is to use it on a cluster o remote server due to the high computational cost it might have.

![lagog4](https://user-images.githubusercontent.com/31867192/212497712-30e0c608-cd9e-4c42-b4b1-292b82ee1d98.png)
This is a screenshot of the Geant4 GUI for the LAGO code we used, with a zenith view of the environment. The small parallelepiped volume inside the cube is the standard rock ground, while the cube itself, filled with air, defines the limits of the laboratory.
